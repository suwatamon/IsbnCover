<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>バーコード認識アプリ</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body>
    Search book's cover from Amazon by ISBN. <br />
    <p>
        Enter ISBN (10 or 13)
        <form action=/reply method=post>
            <input type=text name=isbn value=9784873117522>
            <input type=submit name=submit value=送信>
        </form>
    </p>

    <p>
        Upload ISBN Barcode
        <form action=/barcode method=post enctype="multipart/form-data">
            <input type="file" name="barcode" accept="image/*">
            <input type=submit name=submit_barcode value=Upload>
        </form>
    </p>


    <canvas width="280" height="280" style="border: solid"></canvas>
    <button id="predict">Predict</button>
    <p>予測結果: <span id="result"></span></p>

    <script type="text/javascript">
        var pixels = [];
        for (var i=0; i<28*28; i++) pixels[i] = 0;
        var canvas = document.querySelector("canvas");
        var drawing = false;

        canvas.addEventListener("mousedown", function(){
            drawing = true;
        })

        canvas.addEventListener("mouseup", function(){
            drawing = false;
        })

        canvas.addEventListener("mousemove", function(e){
            if (drawing) {
                var x = Math.floor(e.offsetX/10);
                var y = Math.floor(e.offsetY/10);
                if (0<=x && x<=27 && 0<=y && y<=27){
                    canvas.getContext("2d").fillRect(x*10, y*10, 10, 10);
                    pixels[x+y*28] = 1;
                }
            }
        })

        $("#predict").click(function(){
            $.ajax({
                url: "http://localhost:8888/predict",
                type: "POST",
                data: {"image": pixels.join(",")},
                success: function(result){
                    document.getElementById("result").innerHTML = result;
                }
            })
        });
    </script>


</body>

</html>